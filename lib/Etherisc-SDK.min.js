!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Etherisc-SDK",[],e):"object"==typeof exports?exports["Etherisc-SDK"]=e():t["Etherisc-SDK"]=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={FlightDelay_AddressResolver_Abi:[{constant:!0,inputs:[],name:"getAddress",outputs:[{name:"_oaddr",type:"address"}],type:"function"},{constant:!0,inputs:[],name:"addr",outputs:[{name:"",type:"address"}],type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_newowner",type:"address"}],name:"changeOwner",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_newaddr",type:"address"}],name:"setAddr",outputs:[],type:"function"},{inputs:[{name:"_addr",type:"address"}],type:"constructor"}],FlightDelay_Abi:[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"ledger",outputs:[{name:"",type:"int256"}],type:"function"},{constant:!0,inputs:[],name:"maintenance_mode",outputs:[{name:"",type:"uint8"}],type:"function"},{constant:!1,inputs:[{name:"_queryId",type:"bytes32"},{name:"_result",type:"string"},{name:"_proof",type:"bytes"}],name:"__callback",outputs:[],type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],name:"customerPolicies",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"",type:"bytes32"}],name:"oraclizeCallbacks",outputs:[{name:"policyId",type:"uint256"},{name:"oState",type:"uint8"},{name:"oraclizeTime",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"_customer",type:"address"}],name:"getCustomerPolicyCount",outputs:[{name:"_count",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_from",type:"uint8"},{name:"_to",type:"uint8"},{name:"_amount",type:"uint256"}],name:"audit",outputs:[],type:"function"},{constant:!0,inputs:[{name:"_customer",type:"address"}],name:"getPolicyCount",outputs:[{name:"_count",type:"uint256"}],type:"function"},{constant:!1,inputs:[],name:"payReward",outputs:[],type:"function"},{constant:!0,inputs:[],name:"reentrantGuard",outputs:[{name:"",type:"bool"}],type:"function"},{constant:!0,inputs:[{name:"",type:"bytes32"}],name:"risks",outputs:[{name:"carrierFlightNumber",type:"string"},{name:"departureYearMonthDay",type:"string"},{name:"arrivalTime",type:"uint256"},{name:"delayInMinutes",type:"uint256"},{name:"delay",type:"uint8"},{name:"cumulatedWeightedPremium",type:"uint256"},{name:"premiumMultiplier",type:"uint256"}],type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_maintenance_mode",type:"uint8"}],name:"performHealthCheck",outputs:[],type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"policies",outputs:[{name:"customer",type:"address"},{name:"premium",type:"uint256"},{name:"riskId",type:"bytes32"},{name:"weight",type:"uint256"},{name:"calculatedPayout",type:"uint256"},{name:"actualPayout",type:"uint256"},{name:"state",type:"uint8"},{name:"stateTime",type:"uint256"},{name:"stateMessage",type:"bytes32"},{name:"proof",type:"bytes"}],type:"function"},{constant:!1,payable:!0,inputs:[{name:"_carrierFlightNumber",type:"string"},{name:"_departureYearMonthDay",type:"string"},{name:"_departureTime",type:"uint256"},{name:"_arrivalTime",type:"uint256"}],name:"newPolicy",outputs:[],type:"function"},{inputs:[{name:"_owner",type:"address"}],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"customer",type:"address"},{indexed:!1,name:"carrierFlightNumber",type:"string"},{indexed:!1,name:"premium",type:"uint256"}],name:"LOG_PolicyApplied",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"statistics0",type:"uint256"},{indexed:!1,name:"statistics1",type:"uint256"},{indexed:!1,name:"statistics2",type:"uint256"},{indexed:!1,name:"statistics3",type:"uint256"},{indexed:!1,name:"statistics4",type:"uint256"},{indexed:!1,name:"statistics5",type:"uint256"}],name:"LOG_PolicyAccepted",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"}],name:"LOG_PolicyRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"amount",type:"uint256"}],name:"LOG_PolicyPaidOut",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"}],name:"LOG_PolicyExpired",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"reason",type:"bytes32"}],name:"LOG_PolicyDeclined",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"reason",type:"bytes32"}],name:"LOG_PolicyManualPayout",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"reason",type:"bytes32"}],name:"LOG_SendFail",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"queryId",type:"bytes32"},{indexed:!1,name:"oraclize_url",type:"string"}],name:"LOG_OraclizeCall",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"policyId",type:"uint256"},{indexed:!1,name:"queryId",type:"bytes32"},{indexed:!1,name:"result",type:"string"},{indexed:!1,name:"proof",type:"bytes"}],name:"LOG_OraclizeCallback",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"message",type:"bytes32"},{indexed:!1,name:"diff",type:"int256"},{indexed:!1,name:"balance",type:"uint256"},{indexed:!1,name:"ledgerBalance",type:"int256"}],name:"LOG_HealthCheck",type:"event"}],OAR_Abi:[{constant:!1,inputs:[],name:"getAddress",outputs:[{name:"_addr",type:"address"}],type:"function"},{constant:!0,inputs:[],name:"addr",outputs:[{name:"",type:"address"}],type:"function"}],OraclizeI_Abi:[{constant:!1,inputs:[{name:"_datasource",type:"string"},{name:"gaslimit",type:"uint256"}],name:"getPrice",outputs:[{name:"_dsprice",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_datasource",type:"string"}],name:"getPrice",outputs:[{name:"_dsprice",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_coupon",type:"string"}],name:"useCoupon",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_proofType",type:"bytes1"}],name:"setProofType",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_timestamp",type:"uint256"},{name:"_datasource",type:"string"},{name:"_arg1",type:"string"},{name:"_arg2",type:"string"}],name:"query2",outputs:[{name:"_id",type:"bytes32"}],type:"function"},{constant:!1,inputs:[{name:"_timestamp",type:"uint256"},{name:"_datasource",type:"string"},{name:"_arg1",type:"string"},{name:"_arg2",type:"string"},{name:"_gaslimit",type:"uint256"}],name:"query2_withGasLimit",outputs:[{name:"_id",type:"bytes32"}],type:"function"},{constant:!1,inputs:[{name:"_timestamp",type:"uint256"},{name:"_datasource",type:"string"},{name:"_arg",type:"string"}],name:"query",outputs:[{name:"_id",type:"bytes32"}],type:"function"},{constant:!0,inputs:[],name:"cbAddress",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_timestamp",type:"uint256"},{name:"_datasource",type:"string"},{name:"_arg",type:"string"},{name:"_gaslimit",type:"uint256"}],name:"query_withGasLimit",outputs:[{name:"_id",type:"bytes32"}],type:"function"},{constant:!1,inputs:[{name:"_gasPrice",type:"uint256"}],name:"setCustomGasPrice",outputs:[],type:"function"}]};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=[{id:"",text:""},{id:"AKL",text:"AKL - Auckland, New Zealand Auckland International Airport"},{id:"AMS",text:"AMS - Amsterdam, Netherlands Schiphol"},{id:"ARN",text:"ARN - Stockholm, Sweden Arlanda International"},{id:"ATH",text:"ATH - Athens, Greece - Venizelos"},{id:"ATL",text:"ATL - Atlanta, GA, USA Hartsfield International"},{id:"AYT",text:"AYT - Antalya, Turkey Antalya"},{id:"BCN",text:"BCN - Barcelona, Spain Barcelona"},{id:"BKK",text:"BKK - Bangkok, Thailand Bangkok International Airport"},{id:"BNE",text:"BNE - Brisbane, Queensland, Australia Brisbane International Airport"},{id:"BOG",text:"BOG - Bogota, Colombia Eldorado"},{id:"BOM",text:"BOM - Bombay, India - Mumbai"},{id:"BOS",text:"BOS - Boston, MA, USA Logan International Airport"},{id:"BRU",text:"BRU - Brussels, Belgium National"},{id:"BSB",text:"BSB - Brasilia, Distrito Federal, Brazil International"},{id:"BWI",text:"BWI - Baltimore, MD, USA BaltimoreWashington International"},{id:"CAN",text:"CAN - Guangzhou, China - Baiyun"},{id:"CDG",text:"CDG - Paris, France Charles De Gaulle"},{id:"CGH",text:"CGH - Sao Paulo, Sao Paulo, Brazil Congonhas"},{id:"CGK",text:"CGK - Jakarta, Indonesia Soekarno Hatta International"},{id:"CJU",text:"CJU - Cheju, South Korea Cheju"},{id:"CLT",text:"CLT - Charlotte, NC, USA Charlotte/Douglas Intl Airport"},{id:"CPH",text:"CPH - Copenhagen, Denmark Copenhagen"},{id:"CTS",text:"CTS - Sapporo, Japan Chitose"},{id:"CTU",text:"CTU - Chengdu, China"},{id:"DCA",text:"DCA - Washington, DC, USA Ronald Reagan National Airport"},{id:"DEL",text:"DEL - Delhi, India - Indira Gandhi International Airport"},{id:"DEN",text:"DEN - Denver, CO, USA Denver International"},{id:"DFW",text:"DFW - Dallas/Ft Worth, TX, USA Dallas Ft Worth International"},{id:"DME",text:"DME - Moscow, Russia - Domodedovo"},{id:"DOH",text:"DOH - Doha, Qatar Doha"},{id:"DTW",text:"DTW - Detroit, MI, USA Detroit-Wayne County Metropolitan Airport"},{id:"DUB",text:"DUB - Dublin, Ireland Dublin"},{id:"DUS",text:"DUS - Dusseldorf, Germany Dusseldorf"},{id:"DXB",text:"DXB - Dubai, United Arab Emirates Dubai International Airport"},{id:"EWR",text:"EWR - Newark, NJ, USA Newark International Airport"},{id:"FCO",text:"FCO - Rome, Italy Leonardo Da Vinci/Fiumicino"},{id:"FLL",text:"FLL - Fort Lauderdale, FL, USA Ft Lauderdale/Hollywood Intl Apt"},{id:"FRA",text:"FRA - Frankfurt, Germany Frankfurt International"},{id:"FUK",text:"FUK - Fukuoka, Japan Itazuke"},{id:"GIG",text:"GIG - Rio De Janeiro, Rio De Janeiro, Brazil International Airport"},{id:"GMP",text:"GMP - Seoul, Gimpo International Airport"},{id:"GRU",text:"GRU - Sao Paulo, Sao Paulo, Brazil Guarulhos International"},{id:"HEL",text:"HEL - Helsinki, Finland Helsinki"},{id:"HGH",text:"HGH - Hangzhou, China"},{id:"HKG",text:"HKG - Hong Kong, Hong Kong"},{id:"HND",text:"HND - Tokyo (Ōta), Japan - Haneda (羽田空港) Tokyo International Airport (東京国際空港)"},{id:"IAD",text:"IAD - Washington, DC, USA Dulles"},{id:"IAH",text:"IAH - Houston, TX, USA"},{id:"ICN",text:"ICN - Incheon [Seoul], South Korea - Incheon International Airport"},{id:"IST",text:"IST - Istanbul, Turkey Ataturk"},{id:"JED",text:"JED - Jeddah, Saudi Arabia Jeddah International"},{id:"JFK",text:"JFK - New York, NY, USA John F Kennedy Intl Airport"},{id:"JNB",text:"JNB - Johannesburg, South Africa - O R Tambo International Airport (formerly Jan Smuts)"},{id:"KMG",text:"KMG - Kunming, China Kunming"},{id:"KUL",text:"KUL - Kuala Lumpur, Malaysia - KLIA Kuala Lumpur International"},{id:"LAS",text:"LAS - Las Vegas, NV, USA Mccarran International Airport"},{id:"LAX",text:"LAX - Los Angeles, CA, USA Los Angeles Intl Airport"},{id:"LGA",text:"LGA - New York, NY, USA Laguardia"},{id:"LGW",text:"LGW - London, England, United Kingdom Gatwick"},{id:"LHR",text:"LHR - London, England, United Kingdom Heathrow"},{id:"LIS",text:"LIS - Lisbon, Portugal Lisboa"},{id:"MAD",text:"MAD - Madrid, Spain Barajas"},{id:"MAN",text:"MAN - Manchester, England, United Kingdom International"},{id:"MCO",text:"MCO - Orlando, FL, USA Orlando International Airport"},{id:"MDW",text:"MDW - Chicago, IL, USA - Midway"},{id:"MEL",text:"MEL - Melbourne, Victoria, Australia - Tullamarine"},{id:"MEX",text:"MEX - Mexico City, Distrito Federal, Mexico Juarez Intl Airport"},{id:"MIA",text:"MIA - Miami, FL, USA Miami International Airport"},{id:"MNL",text:"MNL - Manila, Philippines Ninoy Aquino International"},{id:"MSP",text:"MSP - Minneapolis, MN, USA Minneapolis/St Paul Intl Airport"},{id:"MUC",text:"MUC - Munich, Germany Franz Josef Strauss"},{id:"MXP",text:"MXP - Milan, Italy Malpensa"},{id:"NRT",text:"NRT - Tokyo, Japan - Narita"},{id:"ORD",text:"ORD - Chicago, IL, USA - O'hare International Airport"},{id:"ORY",text:"ORY - Paris, France Orly"},{id:"OSL",text:"OSL - Oslo, Norway"},{id:"PEK",text:"PEK - Beijing, China Peking Capital Airport"},{id:"PHL",text:"PHL - Philadelphia, PA, USA Philadelphia International Airport"},{id:"PHX",text:"PHX - Phoenix, AZ, USA Sky Harbor International Airport"},{id:"PMI",text:"PMI - Palma Mallorca, Mallorca Island, Spain Palma Mallorca"},{id:"PVG",text:"PVG - Shanghai, China - Pudong Shanghai Airport"},{id:"RUH",text:"RUH - Riyadh, Saudi Arabia King Khaled Intl"},{id:"SAN",text:"SAN - San Diego, CA, USA Lindbergh International Airport"},{id:"SEA",text:"SEA - Seattle, WA, USA Seattle Tacoma Intl Airport"},{id:"SFO",text:"SFO - San Francisco, CA, USA San Francisco Intl Airport"},{id:"SHA",text:"SHA - Shanghai, China - Shanghai Intl /Hongqiao/"},{id:"SIN",text:"SIN - Singapore, Singapore Changi International Airport"},{id:"SLC",text:"SLC - Salt Lake City, UT, USA Salt Lake City International Arpt"},{id:"STN",text:"STN - London, England, United Kingdom Stansted"},{id:"SVO",text:"SVO - Moscow, Russia - Sheremetyevo"},{id:"SYD",text:"SYD - Sydney, New South Wales, Australia Sydney /KingsfordSmith/ Airport"},{id:"SZX",text:"SZX - Shenzhen, China Shenzhen"},{id:"TPA",text:"TPA - Tampa, FL, USA Tampa International"},{id:"TPE",text:"TPE - Taipei, Taiwan - Taiwan Taoyuan International Airport (formerly Chiang Kai Shek Airport)"},{id:"TXL",text:"TXL - Berlin, Germany Tegel"},{id:"VIE",text:"VIE - Vienna, Austria Schwechat"},{id:"XMN",text:"XMN - Xiamen, China - Xiamen International"},{id:"YVR",text:"YVR - Vancouver, British Columbia, Canada Vancouver International"},{id:"YYZ",text:"YYZ - Toronto, Ontario, Canada - Lester B Pearson International Airport"},{id:"ZRH",text:"ZRH - Zurich, Switzerland Zurich"}];e.default=i,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){console.debug(t)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(0),s=i(u),d=n(1),l=i(d);!function(t,e){var n=t.createElement(e),i=t.getElementsByTagName(e)[0];n.src="https://apis.google.com/js/api.js",i.parentNode.insertBefore(n,i)}(document,"script");var p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.qpxApikey;a(this,t),this.policies=[],this.contractAddress="",this.qpx={qpxApikey:n||"AIzaSyCfYPmq_eOR8fOvix8mDhyDksJWlm8f8Gc"},this.airports=l.default,this.abi=s.default,this.log=r,this.fdiAddrresolverAddr=""}return o(t,[{key:"connect",value:function(){var t=this;return new Promise(function(e,n){void 0!==window.web3&&"function"==typeof window.Web3?(t.web3=new window.Web3(window.web3.currentProvider),t.log("Connected"),e(t.web3)):(t.log("No connection"),n({error:"Install MetaMask plugin"}))})}},{key:"getNetwork",value:function(){var t=this;return new Promise(function(e,n){t.web3.version.getNetwork(function(i,a){"3"===a?(t.network=a,t.log("Network: "+t.network),e(t.network)):(t.log("Unknown network"),n({error:i}))})})}},{key:"getBalance",value:function(){var t=this;return new Promise(function(e,n){t.account=t.web3.eth.accounts[0],t.web3.eth.getBalance(t.account,function(i,a){i?(t.log("getBalance Error: "+i),n({error:i})):(t.ethBalance=Number(t.web3.fromWei(a.toNumber())).toFixed(2),t.log("Account balance: "+t.ethBalance),e(t.ethBalance))})})}},{key:"getFlightContractAddress",value:function(){var t=this;return new Promise(function(e,n){if(t.network&&"3"===t.network){t.fdiAddrresolverAddr="0x370fc54dac87872ec84d20e404c00705f5bb894f",t.log("fdiAddrresolverAddr: "+t.fdiAddrresolverAddr);var i=[{constant:!0,inputs:[],name:"addr",outputs:[{name:"",type:"address"}],type:"function"}],a=function(i,a){i?(t.log(i),n({error:i})):(t.contractAddress=a,t.log("Contract address: "+t.contractAddress),e(t.contractAddress))};t.web3.eth.contract(i).at(t.fdiAddrresolverAddr).addr(a)}})}},{key:"getPolicy",value:function(t,e,n){var i=this;return new Promise(function(a,r){t.customerPolicies(e,n,function(e,o){e&&r({error:e});var u=o.toNumber();t.policies(u,function(e,r){t.risks(r[2],function(t,e){a({id:n,status:i.__statusToString(r[6].toNumber()),flightId:e[0],departure:e[1].slice(5),premium:i.web3.fromWei(r[1]).toFixed(2)})})})})})}},{key:"getPolicies",value:function(){var t=this;return new Promise(function(e,n){var i=t.web3.eth.contract(s.default.FlightDelay_Abi).at(t.contractAddress);try{i.getCustomerPolicyCount(t.account,function(a,r){if(a)t.log(a),n({error:a});else{t.log("Count policies: "+r);for(var o=[],u=0;u<r;u+=1)o.push(t.getPolicy(i,t.account,u));Promise.all(o).then(function(n){t.log(JSON.stringify(n)),t.policies=n,e(n)}).catch(function(t){return n({error:t})})}})}catch(e){t.log(e),n({error:e})}})}},{key:"applyForPolicy",value:function(t,e){var n=this;return new Promise(function(i,a){n.premium=n.web3.toWei(Number(t),"ether"),n.flight=e;var r={from:n.web3.eth.accounts[0],to:n.contractAddress,value:n.premium,gas:1e6},o=n.web3.eth.contract(n.abi.FlightDelay_Abi).at(n.contractAddress);try{o.newPolicy(n.flight.carrier+"/"+n.flight.flightNumber,n.flight.departureYearMonthDay,new Date(n.flight.departureTime).valueOf()/1e3,new Date(n.flight.arrivalTime).valueOf()/1e3,r,function(t,e){t?a({error:t}):(n.transactionReceipt=e,n.log("New policy created: "+JSON.stringify({txHash:e,network:n.network})),i(n.transactionReceipt))})}catch(t){n.log(t),a({error:t})}})}},{key:"validatePremium",value:function(t){var e="",n=Number(this.ethBalance);return n&&t?""!==t&&(t>5||t<.5||n<.501||n<t)?(e=this.ethBalance<.501?"Minimum Balance is 0.501 ETH":t>5?"Maximum Premium is 5.0 ETH":t<.5?"Minimum Premium is 0.5 ETH":n<t?"Balance too low":"Invalid Premium",{valid:!1,message:e}):{valid:!0}:{valid:!1}}},{key:"calculatePayout",value:function(t){var e=t,n=150;return e<.01&&(e=0),e>5&&(e=5),this.ratingTable.payout_15m=Math.min(Number(.97*e*10/this.ratingTable.weight),n).toFixed(2),this.ratingTable.payout_30m=Math.min(Number(.97*e*15/this.ratingTable.weight),n).toFixed(2),this.ratingTable.payout_45m=Math.min(Number(.97*e*30/this.ratingTable.weight),n).toFixed(2),this.ratingTable.payout_can=Math.min(Number(.97*e*50/this.ratingTable.weight),n).toFixed(2),this.ratingTable.payout_div=Math.min(Number(.97*e*50/this.ratingTable.weight),n).toFixed(2),this.ratingTable}},{key:"__statusToString",value:function(t){return{0:"Applied",1:"Accepted",2:"Revoked",3:"Paid Out",4:"Expired",5:"Declined"}[t]}},{key:"getRating",value:function(){var t=this,e=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t};return new Promise(function(n){var i={late15:e(5,10),late30:e(9,15),late45:e(10,13),cancelled:0,diverted:0,observations:e(55,65)};t.rating=i,n(i)})}},{key:"getRatingTable",value:function(t){var e={delay_15m:t.late15/t.observations,delay_30m:t.late30/t.observations,delay_45m:t.late45/t.observations,delay_can:t.cancelled/t.observations,delay_div:t.diverted/t.observations,payout_15m:"0.00",payout_30m:"0.00",payout_45m:"0.00",payout_can:"0.00",payout_div:"0.00",text_15m:Number(t.late15/t.observations*100).toFixed(2),text_30m:Number(t.late30/t.observations*100).toFixed(2),text_45m:Number(t.late45/t.observations*100).toFixed(2),text_can:Number(t.cancelled/t.observations*100).toFixed(2),text_div:Number(t.diverted/t.observations*100).toFixed(2)};return e.weight=10*e.delay_15m+15*e.delay_30m+30*e.delay_45m+50*e.delay_can+50*e.delay_div,this.ratingTable=e,this.ratingTable}},{key:"searchFlights",value:function(t,e,n){var i=this;return new Promise(function(a,r){i.getFlightList(t,e,n,function(t,e){t?r({error:t}):(i.flights=e,i.log(JSON.stringify(i.flights)),a(i.flights))})})}},{key:"getFlightList",value:function(t,e,n,i){var a=this,r={fields:"kind,            trips(              kind,              requestId,              tripOption(                id,                kind,                slice(                  duration,                  kind,                  segment(                    bookingCode,                    bookingCodeCount,                    connectionDuration,                    duration,                    flight,                    id,                    kind,                    leg(                    arrivalTime,                    changePlane,                    connectionDuration,                    departureTime,                    destination,                    duration,                    id,                    kind,                    origin,                    originTerminal                    )                  )                )              )            )          ",request:{passengers:{kind:"qpxexpress#passengerCounts",adultCount:1},slice:[{kind:"qpxexpress#sliceInput",maxStops:0,origin:t,destination:e,date:n}],solutions:10}};gapi.load("client",function(){gapi.client.setApiKey(a.qpx.qpxApikey),gapi.client.load("qpxExpress","v1").then(function(){gapi.client.qpxExpress.trips.search(r).then(function(t){i(!1,a.parseFlights(t))},function(t){i("Error: "+t.result.error.message,!1)})})})}},{key:"parseFlights",value:function(t){var e=[];if(void 0!==t.result.trips.tripOption)for(var n=t.result.trips.tripOption,i=0;i<n.length;i+=1)if(!(n[i].slice[0].segment.length>1)){var a=n[i].slice[0].segment[0],r=a.leg[0],o=new Date(r.departureTime),u=new Date(Date.now()).valueOf();o.valueOf()>u&&e.push({id:"F"+i,carrier:a.flight.carrier,flightNumber:a.flight.number,flightId:a.flight.carrier+"-"+a.flight.number,text:a.flight.carrier+a.flight.number+" : "+r.origin+"-"+r.destination+"; Dep.: "+r.departureTime+"; Arr.: "+r.arrivalTime,origin:r.origin,destination:r.destination,arrivalTime:r.arrivalTime,departureTime:r.departureTime,departureYearMonthDay:"/dep/"+o.getUTCFullYear()+"/"+("0"+(o.getUTCMonth()+1)).slice(-2)+"/"+("0"+o.getUTCDate()).slice(-2),duration:r.duration})}return e.length>0&&e.sort(function(t,e){if("-"==t.id)return 0;var n=new Date(t.departureTime).valueOf(),i=new Date(e.departureTime).valueOf();return n==i?0:n<i?-1:1}),e}}]),t}();e.default=p,t.exports=e.default}])});